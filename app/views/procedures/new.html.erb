<div class="conteiner">
	<div class="row">
		<div class="col-xs-10 col-xs-offset-1">
			<h2>レシピ詳細内容登録</h2>
			<table>
				<tbody>
					<tr>
						<td><%= link_to (@recipe) do %>
							<%= attachment_image_tag @recipe, :image, format: "jpeg" , fallback: "no_image.jpg" %>
						<% end %></td>
						<td><%= @recipe.title %></td>
						<td><%= @recipe.outline %></td>
					</tr>
				</tbody>
			</table>
			<h2>レシピ材料</h2>
			<table>
				<% @materials.each do |material| %>
				<tbody>
					<tr>
						<td><%= attachment_image_tag material, :image, format: "jpeg" , fallback: "no_image.jpg", id: "material-image" %></td>
						<td><%= material.name %></td>
						<td><%= material.quantity %></td>
						<td><%= material.maker %></td>
						<td><%= link_to '編集する' ,edit_recipe_material_path(@recipe.id, material) %></td>
						<td><%= link_to '削除する', recipe_material_path(@recipe.id, material),method: :delete, data: {confirm: "削除してよろしいですか？"} %></td>
					</tr>
				</tbody>
				<% end %>
			</table>
			<h2>レシピ手順</h2>
			<table>
				<% @procedures.each do |procedure| %>
				<tbody>
					<tr>
						<td><%= attachment_image_tag procedure, :image, format: "jpeg" , fallback: "no_image.jpg", id: "procedure-image" %></td>
						<td><%= procedure.explanation %></td>
						<td><%= link_to '編集する' ,edit_recipe_procedure_path(@recipe.id, procedure) %></td>
						<td><%= link_to '削除する', recipe_procedure_path(@recipe.id, procedure),method: :delete, data: {confirm: "削除してよろしいですか？"} %></td>
					</tr>
				</tbody>
				<% end %>
			</table>
			<div class="row">
			<h3>手順登録</h3>
			<!-- エラーメッセージ -->
			<% if @procedure.errors.any? %>
			    <div id="error_explanation" class="alert alert-danger">
			    	<ul>
				        <% @procedure.errors.full_messages.each do |message| %>
				            <li><%= message %></li>
				        <% end %>
			    	</ul>
			    </div>
			<% end %>
			<!-- エラーメッセージ -->
				<%= form_for @procedure, url: recipe_procedures_path do |f| %>
				<table>
					<tr>
						<th>画像</th>
				        <th>手順説明</th>
				        <th></th>
				    </tr>
				    <tr>
				    	<td><%= attachment_image_tag @procedure, :image, fallback: "no_image.jpg", id: "file-preview" %>
						<%= f.attachment_field :image, class: "btn  item_attachment_field", id: "image_select"%>
						<label for="image_select" class="btn btn-primary item_attachment_field" style="display: block;">画像選択</label></td>
				        <td><%= f.text_area :explanation, class: 'form-control' %></td>
				        <td><%= f.submit "手順を追加" ,class: "btn btn-lg" %></td>
				    </tr>
				</table>
	            	<div><%= link_to '確定' ,recipe_path(@recipe) ,class: "btn btn-primary btn-lg" %></div>
		        <% end %>
			</div>
		</div>
	</div>
</div>
<!-- 画像選択した際に、選択した画像を表示させるjavascript -->
<script>
	document.getElementById('image_select').addEventListener('change', function (e) {
    // 1枚だけ表示する
    var file = e.target.files[0];

    // ファイルのブラウザ上でのURLを取得する
    var blobUrl = window.URL.createObjectURL(file);

    // img要素に表示
    var img = document.getElementById('file-preview');
    img.src = blobUrl;
});
</script>
