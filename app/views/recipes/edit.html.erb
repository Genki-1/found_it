<div class="conteiner">
	<div class="row">
		<div class="col-xs-10 col-xs-offset-1">
			<!-- エラーメッセージ -->
			<% if @recipe.errors.any? %>
			    <div id="error_explanation" class="alert alert-danger">
			    	<ul>
				        <% @recipe.errors.full_messages.each do |message| %>
				            <li><%= message %></li>
				        <% end %>
			    	</ul>
			    </div>
			<% end %>
			<!-- エラーメッセージ -->
			<%= form_for(@recipe, url:recipe_path) do |f| %>
			<div class="row">
				<div class="row">
					<div class="col-xs-7">
						<h2>レシピタイトル<%= f.text_field :title, class: "form-control" %></h2>
					</div>
					<div class="col-xs-3">
						<%= link_to '削除する', recipe_path(@recipe),method: :delete, class: "btn btn-danger"%>
					</div>
				</div>
				<div class="col-xs-4">
					<h3>画像</h3>
					<%= attachment_image_tag @recipe, :image, :fill, 300, 200,format: "jpeg" , fallback: "no_image.jpg", size:'300x200', id: "file-preview" %>
					<%= f.attachment_field :image, class: "btn  item_attachment_field", id: "image_select"%>
					<label for="image_select" class="btn btn-primary item_attachment_field" style="display: block;">画像選択</label>
				</div>
				<div class="col-xs-8">
					<div class="row">
						<h3>カテゴリー</h3>
						 <%= f.grouped_collection_select(:category_id, ParentCategory.all, :category, :name, :id, :name,{include_blank: '選択してください'},class: 'form-control' )%>
						<h3>概要</h3>
						<%= f.text_area :outline, class: "form-control" %>
						<h3>公開・非公開</h3>
							<h4><%= f.radio_button :is_closed, :true, checked: true %> 非公開
							<%= f.radio_button :is_closed, :false %> 公開
							</h4>
						<div class="action">
							<%= f.submit "変更" ,class: "btn btn-primary btn-lg" %>
						</div>
					</div>
					<div class="row">
					<h2>レシピ材料 <%= link_to '材料の新規追加',new_recipe_material_path(@recipe),class: "btn btn-primary" %></h2>
						<table class="table">
							<thead>
								<tr>
									<th class="col-xs-2">画像</th>
									<th class="col-xs-3">材料名</th>
									<th class="col-xs-2">数量</th>
									<th class="col-xs-3">メーカー（任意）</th>
									<th colspan="2"></th>
								</tr>
							</thead>
							<tbody>
								<% @materials.each do |material| %>
								<tr>
									<td><%= attachment_image_tag material, :image, format: "jpeg" , fallback: "no_image.jpg", id: "material-image" %></td>
									<td><%= material.name %></td>
									<td><%= material.quantity %></td>
									<td><%= material.maker %></td>
									<td><%= link_to '編集' ,edit_recipe_material_path(@recipe.id, material) %></td>
									<td><%= link_to '削除', recipe_material_path(@recipe.id, material),method: :delete, data: {confirm: "削除してよろしいですか？"} %></td>
								</tr>
								<% end %>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="row">
				<h2>レシピ手順 <%= link_to '手順の新規追加',new_recipe_procedure_path(@recipe),class: "btn btn-primary" %></h2>
				<table class="table">
					<thead>
						<tr>
							<th class="col-xs-1"></th>
							<th class="col-xs-2">画像</th>
					        <th class="col-xs-7">手順説明</th>
					        <th></th>
					    </tr>
					</thead>
					<% @procedures.each.with_index(1) do |procedure, idx| %>
					<tbody>
						<tr>
							<td><%= idx %></td>
							<td><%= attachment_image_tag procedure, :image, format: "jpeg" , fallback: "no_image.jpg", id: "procedure-image" %></td>
							<td><%= procedure.explanation %></td>
							<td><%= link_to '編集' ,edit_recipe_procedure_path(@recipe.id, procedure) %></td>
							<td><%= link_to '削除', recipe_procedure_path(@recipe.id, procedure),method: :delete, data: {confirm: "削除してよろしいですか？"} %></td>
						</tr>
					</tbody>
					<% end %>
				</table>
			<% end %>
			</div>
			<div>
				<%= link_to '編集内容を保存' ,recipe_path(@recipe) ,class: "btn btn-primary btn-lg" %>
			</div>
		</div>
	</div>
</div>
<!-- 画像選択した際に、選択した画像を表示させるjavascript -->
<script>
	document.getElementById('image_select').addEventListener('change', function (e) {
    // 1枚だけ表示する
    var file = e.target.files[0];

    // ファイルのブラウザ上でのURLを取得する
    var blobUrl = window.URL.createObjectURL(file);

    // img要素に表示
    var img = document.getElementById('file-preview');
    img.src = blobUrl;
});
</script>