<div class="conteiner">
	<div class="row">
		<div class="col-xs-10 col-xs-offset-1">
			<h2>レシピ詳細内容登録</h2>
			<table>
				<tbody>
					<tr>
						<%= attachment_image_tag @recipe, :image, format: "jpeg" , fallback: "no_image.jpg" %>
						<%= @recipe.title %>
						<%= @recipe.outline %>
					</tr>
				</tbody>
			</table>
			<div class="row">
				<%= form_for(@recipe,url:detail_new_recipe_path) do |f| %>
				<h3>材料登録</h3>
				<table>
					<tr>
						<th>画像</th>
			            <th>名称</th>
			            <th>数量</th>
			            <th>メーカー</th>
			            <th></th>
			        </tr>
			        <tr>
			        <%= f.nested_fields_for :materials, wrapper_tag: :tr do |q| %>
			        	<td><%= attachment_image_tag @material, :image, fallback: "no_image.jpg", id: "file-preview" %>
						<%= f.attachment_field :image, class: "btn  item_attachment_field", id: "image_select"%>
						<label for="image_select" class="btn item_attachment_field" style="display: block;">画像選択</label></td>
		                <td><%= q.text_field   :name,     class: 'form-control' %></td>
		                <td><%= q.number_field :quantity, class: 'form-control' %></td>
		                <td><%= q.text_field   :maker,     class: 'form-control' %></td>
		                <td><%= q.remove_nested_fields_link 'Delete', class: 'btn btn-danger', role: 'button' %></td>
		            <% end %>
		      </table>
      			<%= f.add_nested_fields_link :materials, 'Add new', class: 'btn btn-primary', role: 'button' %>
					<%= f.submit "材料を保存する" ,class: "btn btn-lg" %>
					<% end %>
			</div>
		</div>
	</div>
</div>
<!-- 画像選択した際に、選択した画像を表示させるjavascript -->
<script>
	document.getElementById('image_select').addEventListener('change', function (e) {
    // 1枚だけ表示する
    var file = e.target.files[0];

    // ファイルのブラウザ上でのURLを取得する
    var blobUrl = window.URL.createObjectURL(file);

    // img要素に表示
    var img = document.getElementById('file-preview');
    img.src = blobUrl;
});
</script>